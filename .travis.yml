language: android
before_install: #1.1
  - nvm install 12
  - node --version
dist: trusty
android:
  components:
    - tools
    - platform-tools
    - build-tools-28.0.3
    - android-28
    - extra

stages:
  - install
  #   - static-analysis
  - build
  - release

before_script:
  - make setup

cache:
  directories:
    - node_modules
    - android/app/build/outputs/apk
    - .code-push

jobs:
  include:
    - stage: install
      name: Project dependencies
      script:
        - make yarn-install
    # - stage: static-analysis
    #   name: Static analysis (ESLint and Flow)
    #   script:
    #     - make yarn-static-analysis
    - stage: build
      #   if: tag IS present
      name: Build Android app
      script:
        - rm -rf .cache
        - make set-env-production
        - make android-prepare
        - make android-release
    - stage: release
      #   if: tag IS present
      name: Release Android app
      script:
        - make code-push-prepare
        - make code-push-production
